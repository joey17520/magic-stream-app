{
  "title": "MagicStream 监控仪表盘",
  "tags": ["magicstream", "monitoring", "api"],
  "style": "dark",
  "timezone": "browser",
  "editable": true,
  "refresh": "5s",
  "schemaVersion": 38,
  "version": 1,
  "links": [],
  "panels": [
    {
      "id": 1,
      "title": "HTTP请求总数",
      "type": "stat",
      "gridPos": { "h": 3, "w": 6, "x": 0, "y": 0 },
      "targets": [
        {
          "expr": "sum(http_requests_total)",
          "legendFormat": "总请求数"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "value" }
        }
      }
    },
    {
      "id": 2,
      "title": "活跃请求数",
      "type": "stat",
      "gridPos": { "h": 3, "w": 6, "x": 6, "y": 0 },
      "targets": [
        {
          "expr": "http_requests_in_flight",
          "legendFormat": "活跃请求"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "value" }
        }
      }
    },
    {
      "id": 3,
      "title": "电影观看总数",
      "type": "stat",
      "gridPos": { "h": 3, "w": 6, "x": 12, "y": 0 },
      "targets": [
        {
          "expr": "movies_viewed_total",
          "legendFormat": "电影观看"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "value" }
        }
      }
    },
    {
      "id": 4,
      "title": "用户注册总数",
      "type": "stat",
      "gridPos": { "h": 3, "w": 6, "x": 18, "y": 0 },
      "targets": [
        {
          "expr": "users_registered_total",
          "legendFormat": "用户注册"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "value" }
        }
      }
    },
    {
      "id": 5,
      "title": "HTTP请求速率（按状态码）",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 3 },
      "targets": [
        {
          "expr": "sum by (status) (rate(http_requests_total[5m]))",
          "legendFormat": "状态码 {{status}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 6,
      "title": "HTTP请求延迟（P95）",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 3 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, method, path))",
          "legendFormat": "P95 {{method}} {{path}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 7,
      "title": "数据库操作速率",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 11 },
      "targets": [
        {
          "expr": "sum by (operation, collection) (rate(db_operations_total[5m]))",
          "legendFormat": "{{operation}} {{collection}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 8,
      "title": "数据库操作延迟（P95）",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 11 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(db_operation_duration_seconds_bucket[5m])) by (le, operation, collection))",
          "legendFormat": "P95 {{operation}} {{collection}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 9,
      "title": "请求/响应大小",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 19 },
      "targets": [
        {
          "expr": "avg_over_time(http_request_size_bytes_sum[5m]) / avg_over_time(http_request_size_bytes_count[5m])",
          "legendFormat": "平均请求大小"
        },
        {
          "expr": "avg_over_time(http_response_size_bytes_sum[5m]) / avg_over_time(http_response_size_bytes_count[5m])",
          "legendFormat": "平均响应大小"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "id": 10,
      "title": "业务指标趋势",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 19 },
      "targets": [
        {
          "expr": "rate(movies_viewed_total[5m])",
          "legendFormat": "电影观看速率"
        },
        {
          "expr": "rate(users_registered_total[5m])",
          "legendFormat": "用户注册速率"
        },
        {
          "expr": "rate(recommendations_generated_total[5m])",
          "legendFormat": "推荐生成速率"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "color": { "mode": "palette-classic" }
        }
      }
    }
  ],
  "templating": {
    "list": [
      {
        "name": "datasource",
        "type": "datasource",
        "query": "prometheus",
        "current": {
          "text": "Prometheus",
          "value": "Prometheus"
        }
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
  }
}
